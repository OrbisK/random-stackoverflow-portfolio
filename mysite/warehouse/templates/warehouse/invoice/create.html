{% extends 'warehouse/base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'warehouse/css/invoice/create.css' %}">
{% endblock %}

{% block content %}

    <div class="container">
        <h2>請求書の作成</h2>
        <form method="POST" action="{% url 'war:invoice_create' %}">
            {% csrf_token %}
            <input type="text" id="date-range-picker">
            <input type="hidden" id="selected-range-start" name="selected_range_start">
            <input type="hidden" id="selected-range-end" name="selected_range_end">
            <input type="hidden" id="highlighted-dates" name="highlighted_dates">
            <button type="submit">Submit</button>
        </form>

        <form>
            {% csrf_token %}
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="{{ form.company.id_for_label }}">会社:</label>
                <div class="col-md-10">
                    {{ form.company }}
                </div>
            </div>
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="{{ form.billing_person.id_for_label }}">請求先担当者:</label>
                <div class="col-md-10">
                    {{ form.billing_person }}
                </div>
            </div>
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="{{ form.rental_start_date.id_for_label }}">貸出日:</label>
                <div class="col-md-10">
                    {{ form.rental_start_date }}
                </div>
            </div>
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="{{ form.rental_end_date.id_for_label }}">返却日:</label>
                <div class="col-md-10">
                    {{ form.rental_end_date }}
                </div>
            </div>
            <div class="form-group row">
                <label class="col-md-2 col-form-label" for="{{ form.staff.id_for_label }}">担当者:</label>
                <div class="col-md-10">
                    {{ form.staff }}
                </div>
            </div>
            <div class="form-group row">
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary" name="submit_type" value="create_invoice" formmethod="post" formaction="{% url 'war:invoice_create' %}">請求書を作成する</button>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-secondary" name="submit_type" value="go_back" formmethod="get" formaction="{% url 'war:index' %}" formnovalidate>戻る</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        const rangePicker = flatpickr("#date-range-picker", {
            mode: "range",
            dateFormat: "Y-m-d",
            minDate: "2023-04-01",
            maxDate: "2023-04-30",
            onChange: function(selectedDates, dateStr, instance) {
                const selectedRangeStart = document.getElementById("selected-range-start");
                const selectedRangeEnd = document.getElementById("selected-range-end");
                selectedRangeStart.value = selectedDates[0] ? selectedDates[0].toISOString().slice(0, 10) : "";
                selectedRangeEnd.value = selectedDates[1] ? selectedDates[1].toISOString().slice(0, 10) : "";
            }
        });

        rangePicker.config.onReady = function(selectedDates, dateStr, instance) {
            const highlightedDates = ["2023-04-13", "2023-04-21"];
            const highlightedDatesInput = document.getElementById("highlighted-dates");
            highlightedDatesInput.value = JSON.stringify(highlightedDates);
            rangePicker.config.onDayCreate = function(dObj, dStr, fp, dayElem) {
                if (highlightedDates.includes(dStr)) {
                    dayElem.classList.add("highlight");
                }
            };
        };
    </script>

{% endblock %}
